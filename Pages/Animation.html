<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>p5.js Kaleidoscope</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/p5.js"></script> <style>
        /* Basic styling to remove default margin/padding and hide scrollbars */
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrollbars */
            background-color: #000; /* Black background for the page */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #ccc;
            font-family: sans-serif;
            text-align: center;
        }
        /* Style for the p5.js canvas */
        canvas {
            display: block;
            border: 1px solid #555; /* Optional border for the canvas */
        }
        #instructions {
             position: absolute;
             bottom: 10px;
             left: 50%;
             transform: translateX(-50%);
             font-size: 0.9em;
             color: #888;
        }
    </style>
</head>
<body>
    <div id="instructions">Click and drag mouse to draw | Press SPACEBAR to clear</div>

    <script>
        let symmetry = 6; // Number of reflection segments (try 6, 8, 10, 12...)
        let angle; // Angle between segments
        let clearColor = 0; // Background color (0 = black)

        // p5.js setup function: runs once at the start
        function setup() {
          createCanvas(windowWidth * 0.9, windowHeight * 0.9); // Create canvas, slightly smaller than window
          angle = TWO_PI / symmetry; // Calculate angle in radians
          background(clearColor); // Set initial background
          strokeWeight(4); // Set initial line thickness
          colorMode(HSB); // Use HSB color mode (Hue, Saturation, Brightness) for smooth color transitions
          // Optional: Increase drawing smoothness
          // pixelDensity(1); // Use if performance is an issue on high-density displays
        }

        // p5.js draw function: runs continuously in a loop
        function draw() {
          // Translate origin (0,0) to the center of the canvas
          translate(width / 2, height / 2);

          // Only draw if the mouse is inside the canvas and pressed
          if (mouseX > 0 && mouseX < width && mouseY > 0 && mouseY < height) {
            if (mouseIsPressed) {
                // Calculate mouse coordinates relative to the center
                let mx = mouseX - width / 2;
                let my = mouseY - height / 2;
                let pmx = pmouseX - width / 2;
                let pmy = pmouseY - height / 2;

                // Calculate mouse speed
                let speed = dist(mouseX, mouseY, pmouseX, pmouseY);
                // Map speed to stroke weight (thicker lines for faster movement)
                let sw = map(speed, 0, 20, 1, 8); // Adjust range as needed
                strokeWeight(sw);

                // Set stroke color based on frameCount (cycles through hues)
                // Alpha (opacity) is added for a slightly softer look
                stroke((frameCount * 0.5) % 360, 85, 95, 0.7);

                // Loop through each symmetry segment
                for (let i = 0; i < symmetry; i++) {
                  // Rotate the canvas by the segment angle
                  rotate(angle);

                  // Draw the line from previous to current mouse position (relative to center)
                  line(pmx, pmy, mx, my);

                  // Create the reflection by flipping vertically and drawing again
                  push(); // Save the current transformation state
                  scale(1, -1); // Flip vertically
                  line(pmx, pmy, mx, my);
                  pop(); // Restore the transformation state
                }
            }
          }
        }

        // p5.js function: runs when a key is pressed
        function keyPressed() {
            // Clear the background if the spacebar is pressed
            if (key === ' ') {
                background(clearColor);
            }
            // Example: Add more controls like changing symmetry
            // if (keyCode === UP_ARROW) {
            //     symmetry++;
            //     angle = TWO_PI / symmetry;
            //     background(clearColor); // Clear when changing symmetry
            // }
            // if (keyCode === DOWN_ARROW && symmetry > 1) {
            //     symmetry--;
            //     angle = TWO_PI / symmetry;
            //     background(clearColor); // Clear when changing symmetry
            // }
        }

         // p5.js function: handle window resizing
        function windowResized() {
           resizeCanvas(windowWidth * 0.9, windowHeight * 0.9);
           background(clearColor); // Clear background on resize
        }

    </script>
</body>
</html>